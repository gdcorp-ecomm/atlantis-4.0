<?xml version="1.0" encoding="utf-8" ?>
<RuleEngine>
  <Rules>
    <RuleMain id="RMain">
      <Actions>
        <Execute ruleId="RValidateFirstName" />
        <Execute ruleId="RRequireFLastName" />
        <Execute ruleId="RRequireFUserName" />
        <Execute ruleId="RValidatePassword" />
        <Execute ruleId="RRequireFPin" />
        <Execute ruleId="RRequireFEmail" />
      </Actions>
    </RuleMain>
    
    <!-- START First Name rules driver -->
    <Rule id="RValidateFirstName">
      <Actions>
        <!-- List the rules that should be executed in order to validate first name -->
        <Execute ruleId="RRequireFFirstName" />
        <!--<Execute factId="RFirstNameRegex" result="true" />-->
      </Actions>
    </Rule>
    <!-- Create the rules that are required to validate first name -->
    <Rule id="RRequireFFirstName">
      <Condition><![CDATA[ ISNULLOREMPTY(FFirstName) ]]></Condition>
      <Actions>
        <EvaluateIsValid factId="FFirstName" result="True">false</EvaluateIsValid>
        <EvaluateMessage factId="FFirstName" result="True"><![CDATA[ "First name is required." ]]></EvaluateMessage>
      </Actions>
    </Rule>
    <!-- END First Name rules driver -->
    
    <Rule id="RRequireFLastName">
      <Condition><![CDATA[ ISNULLOREMPTY(FLastName) ]]></Condition>
      <Actions>
        <EvaluateIsValid factId="FLastName" result="True">false</EvaluateIsValid>
        <EvaluateMessage factId="FLastName" result="True"><![CDATA[ "Last name is required." ]]></EvaluateMessage>
      </Actions>
    </Rule>
    <Rule id="RRequireFUserName">
      <Condition><![CDATA[ ISNULLOREMPTY(FUserName) ]]></Condition>
      <Actions>
        <EvaluateIsValid factId="FUserName" result="True">false</EvaluateIsValid>
        <EvaluateMessage factId="FUserName" result="True"><![CDATA[ "Username is required." ]]></EvaluateMessage>
      </Actions>
    </Rule>

    <!-- START Password rules driver -->
    <Rule id="RValidatePassword">
      <Actions>
        <!-- List the rules that should be executed in order to validate first name -->
        <Execute ruleId="RRequireFPassword" />
        <Execute ruleId="RMaxLengthFPassword" />
        <Execute ruleId="RMinLengthFPassword" />
        <Execute ruleId="RRegexFPassword" />
        <Execute ruleId="RRequireFPassword2" />
        <Execute ruleId="RMatchFPasswordFPassword2" />
      </Actions>
    </Rule>
    <!-- Create the rules that are required to validate password -->
    <Rule id="RRequireFPassword">
      <Condition><![CDATA[ ISNULLOREMPTY(FPassword) ]]></Condition>
      <Actions>
        <EvaluateIsValid factId="FPassword" result="True">false</EvaluateIsValid>
        <EvaluateMessage factId="FPassword" result="True"><![CDATA[ "Password is required." ]]></EvaluateMessage>
      </Actions>
    </Rule>
    <Rule id="RMaxLengthFPassword">
      <Condition><![CDATA[ FPassword @MAXLENGTH FPasswordMaxLength ]]></Condition>
      <Actions>
        <EvaluateIsValid factId="FPassword" result="False">false</EvaluateIsValid>
        <EvaluateMessage factId="FPassword" result="False"><![CDATA[ "Password cannot be longer than " + FPasswordMaxLength + " characters long." ]]></EvaluateMessage>
      </Actions>
    </Rule>
    <Rule id="RMinLengthFPassword">
      <Condition><![CDATA[ FPassword @MINLENGTH FPasswordMinLength ]]></Condition>
      <Actions>
        <EvaluateIsValid factId="FPassword" result="False">false</EvaluateIsValid>
        <EvaluateMessage factId="FPassword" result="False"><![CDATA[ "Password must be at least " + FPasswordMinLength + " characters long." ]]></EvaluateMessage>
      </Actions>
    </Rule>
    <Rule id="RRegexFPassword">
      <Condition><![CDATA[ FPassword @REGEX FPasswordRegex ]]></Condition>
      <Actions>
        <EvaluateIsValid factId="FPassword" result="False">false</EvaluateIsValid>
        <EvaluateMessage factId="FPassword" result="False"><![CDATA[ "Password doesn't match regex." ]]></EvaluateMessage>
      </Actions>
    </Rule>
    <Rule id="RRequireFPassword2">
      <Condition><![CDATA[ ISNULLOREMPTY(FPassword2) ]]></Condition>
      <Actions>
        <EvaluateIsValid factId="FPassword2" result="True">false</EvaluateIsValid>
        <EvaluateMessage factId="FPassword2" result="True"><![CDATA[ "Confirm password is required." ]]></EvaluateMessage>
      </Actions>
    </Rule>
    <Rule id="RMatchFPasswordFPassword2">
      <Condition><![CDATA[ FPassword != FPassword2 ]]></Condition>
      <Actions>
        <EvaluateIsValid factId="FPassword2" result="True">false</EvaluateIsValid>
        <EvaluateMessage factId="FPassword2" result="True"><![CDATA[ "Passwords must match." ]]></EvaluateMessage>
      </Actions>
    </Rule>
    <!-- END Password rules driver -->
    
    <Rule id="RRequireFPin">
      <Condition><![CDATA[ ISNULLOREMPTY(FPin) ]]></Condition>
      <Actions>
        <EvaluateIsValid factId="FPin" result="True">false</EvaluateIsValid>
        <EvaluateMessage factId="FPin" result="True"><![CDATA[ "PIN is required." ]]></EvaluateMessage>
      </Actions>
    </Rule>
    <Rule id="RRequireFEmail">
      <Condition><![CDATA[ ISNULLOREMPTY(FEmail) ]]></Condition>
      <Actions>
        <EvaluateIsValid factId="FEmail" result="True">false</EvaluateIsValid>
        <EvaluateMessage factId="FEmail" result="True"><![CDATA[ "Email is required." ]]></EvaluateMessage>
      </Actions>
    </Rule>
  </Rules>
  <!--
    After this rules doc is compiled, the following "Fact" elements exist in memory as a Fact object with
    three properties: Value, IsValid, Messages.
    
    ######################################### Fact properties #########################################
    ## Value: When using the rule engine, the developer must pass this XML document along with a dictionary
    #         that contains the initial value of the facts. The "Value" property is the value as passed in
    #         the dictionary.
    ## IsValid = true: This is initialized to true so it is the rule designer's job to determine what
    #                  causes this rule to toggle to false.
    ## Messages: As facts are being analyzed, the developer can choose to attach a message string to that
    #            fact. This "Messages" property is simply a list containing those facts.
    ###################################################################################################
  -->
  <Facts>
    <!--Model values to validate-->
    <Fact id="FFirstName"   key="txtFirstName"        type="string" modelId="Shopper" />
    <Fact id="FLastName"    key="txtLastName"         type="string" modelId="Shopper" />
    <Fact id="FUserName"    key="txtUserName"         type="string" modelId="Shopper" />
    <Fact id="FPassword"    key="txtCreatePassword"   type="string" modelId="Shopper" />
    <Fact id="FPassword2"   key="txtCreatePassword2"  type="string" modelId="Shopper" />
    <Fact id="FPin"         key="txtPin"              type="string" modelId="Shopper" />
    <Fact id="FEmail"       key="txtEmail"            type="string" modelId="Shopper" />
    
    <!--Values used to validate the other facts (regex, max, min, etc.)-->
    <Fact id="FPasswordMaxLength" key="passwordMaxLength" type="string" modelId="Shopper" />
    <Fact id="FPasswordMinLength" key="passwordMinLength" type="string" modelId="Shopper" />
    <Fact id="FPasswordRegex"     key="passwordRegex"     type="string" modelId="Shopper" />
  </Facts>
</RuleEngine>
